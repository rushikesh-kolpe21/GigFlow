{
    "sourceFile": "backend/index.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768299750618,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768299750618,
            "name": "Commit-0",
            "content": "const express = require('express');\r\nconst app = express();\r\nconst cors = require('cors');\r\nconst cookieParser = require('cookie-parser');\r\nconst http = require(\"http\");\r\nconst { Server } = require(\"socket.io\");\r\n\r\n// CORS configuration for cookies\r\napp.use(cors({\r\n    origin: 'http://localhost:5173', // Your frontend URL\r\n    credentials: true, // Allow cookies\r\n    methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],\r\n    allowedHeaders: ['Content-Type', 'Authorization']\r\n}));\r\n\r\napp.use(express.json());\r\napp.use(cookieParser());\r\n\r\nconst PORT = process.env.PORT || 5000;\r\n\r\n// load environment variables\r\nrequire('dotenv').config();\r\nrequire('./Models/dbConn');// only checking connection\r\n\r\nconst server = http.createServer(app);\r\n\r\n\r\n// Socket.io server\r\nconst io = new Server(server, {\r\n  cors: {\r\n    origin: \"http://localhost:5173\",\r\n    credentials: true\r\n  }\r\n});\r\n\r\n// userId - socketId map\r\nconst onlineUsers = new Map();\r\n\r\nio.on(\"connection\", (socket) => {\r\n  console.log(\"Socket connected:\", socket.id);\r\n\r\n  socket.on(\"register\", (userId) => {\r\n     onlineUsers.set(userId.toString(), socket.id);\r\n     console.log(` User registered: ${userId.toString()} -> ${socket.id}`);\r\n  });\r\n\r\n  socket.on(\"disconnect\", () => {\r\n    for (let [key, value] of onlineUsers.entries()) {\r\n      if (value === socket.id) {\r\n        onlineUsers.delete(key);\r\n      }\r\n    }\r\n  });\r\n});\r\n\r\n// make available in routes\r\napp.set(\"io\", io);\r\napp.set(\"onlineUsers\", onlineUsers);\r\n\r\n\r\n\r\n// bid router\r\nconst bidRouter = require('./Routers/Bid');\r\napp.use('/api/bids', bidRouter);\r\n\r\n// gig router\r\nconst gigRouter = require('./Routers/Gig');\r\napp.use('/api/gigs', gigRouter);\r\n\r\n\r\n// Auth router\r\nconst authRouter = require('./Routers/Auth');\r\napp.use('/api/auth', authRouter);\r\n\r\n// start the server\r\nserver.listen(PORT, () => {\r\n    console.log(`Server is running on port: ${PORT}`);\r\n});\r\n"
        }
    ]
}