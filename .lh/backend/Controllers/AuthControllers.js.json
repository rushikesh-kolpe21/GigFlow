{
    "sourceFile": "backend/Controllers/AuthControllers.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768305468790,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768305468790,
            "name": "Commit-0",
            "content": "const Users = require('../Models/Users');\r\n\r\n\r\nconst bcrypt = require('bcrypt');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// SIGNUP CONTROLLER\r\nconst signup = async ( req, res ) => {\r\n    try {\r\n        \r\n        const {firstName, lastName, email, password} = req.body;\r\n\r\n        // Validate required fields\r\n        if (!firstName || !lastName || !email || !password) {\r\n            return res.status(400).json({\r\n                message: \"All fields are required\",\r\n                success: false,\r\n            });\r\n        }\r\n\r\n        // check if user already exists\r\n        const existingUser = await Users.findOne({email});\r\n        if(existingUser){\r\n            return res.status(400)\r\n            .json({\r\n                message: \"User already exists\",\r\n                success:false,\r\n            })\r\n        }\r\n\r\n        \r\n        // hash the password\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n         // create new user \r\n        const newUser = new Users({\r\n            firstName,\r\n            lastName,\r\n            email,\r\n            password: hashedPassword,\r\n        })\r\n        await newUser.save();\r\n // create JWT token BEFORE sending response\r\n        const token = jwt.sign(\r\n            {userId: newUser._id, email: newUser.email}, // payload\r\n            process.env.JWT_SECRET, // secret key\r\n            {expiresIn: '1h'} // options\r\n        );\r\n\r\n        // Set cookies (same as login)\r\n        res.cookie('token', token, {\r\n            httpOnly: true,    \r\n            secure: process.env.NODE_ENV === 'production',\r\n            sameSite: 'lax',    \r\n            maxAge: 3600000      \r\n        });\r\n        \r\n        res.cookie('userInfo', JSON.stringify({\r\n            id: newUser._id,\r\n            name: `${newUser.firstName} ${newUser.lastName}`,\r\n            email: newUser.email,\r\n        }), {\r\n            httpOnly: false,     \r\n            secure: process.env.NODE_ENV === 'production',\r\n            sameSite: 'lax',\r\n            maxAge: 3600000\r\n        });\r\n\r\n        res.status(201)\r\n        .json({\r\n            message: \"User registered successfully\",\r\n            success:true,\r\n            token,\r\n            user: {\r\n                id: newUser._id,\r\n                name: `${newUser.firstName} ${newUser.lastName}`,\r\n                email: newUser.email,\r\n            }\r\n        })\r\n    }\r\n    catch (error) {\r\n         res.status(500)\r\n        .json({\r\n           message: \"internal server erorr\",\r\n            success:false,\r\n            error: error.message,\r\n        });\r\n    }\r\n}\r\n\r\n// LOGIN CONTROLLER\r\n\r\nconst login = async ( req, res ) => {\r\n    try {\r\n        const {email, password} = req.body;\r\n        \r\n        // Validate required fields\r\n        if (!email || !password) {\r\n            return res.status(400).json({\r\n                message: \"Email and password are required\",\r\n                success: false,\r\n            });\r\n        }\r\n        \r\n        // check if user exists\r\n        const userExists = await Users.findOne({email});  \r\n        if(!userExists){\r\n            return res.status(400).json({\r\n                message: \"User does not exist\",\r\n                success: false\r\n            });\r\n        }\r\n\r\n        // compare password\r\n        const isPasswordValid = await bcrypt.compare(password, userExists.password);\r\n        if(!isPasswordValid){\r\n            return res.status(400).json({\r\n                message: \"Invalid password\",\r\n                success: false\r\n            });\r\n        }   \r\n        // create JWT token\r\n        const token = jwt.sign(\r\n            {userId: userExists._id, useremail: userExists.email}, // payload\r\n            process.env.JWT_SECRET, // secret key\r\n            {expiresIn: '1h'} // options\r\n        );  \r\n\r\n        // Set cookies\r\n        res.cookie('token', token, {\r\n            httpOnly: true,    \r\n            secure: process.env.NODE_ENV === 'production',\r\n            sameSite: 'lax',    \r\n            maxAge: 3600000      \r\n        });\r\n        \r\n        res.cookie('userInfo', JSON.stringify({\r\n            id: userExists._id,\r\n            name: `${userExists.firstName} ${userExists.lastName}`,\r\n            email: userExists.email,\r\n        }), {\r\n            httpOnly: false,     \r\n            secure: process.env.NODE_ENV === 'production',\r\n            sameSite: 'lax',\r\n            maxAge: 3600000\r\n        });\r\n\r\n\r\n        res.status(200).json({\r\n            message: \"Login successful\",\r\n            success: true,\r\n            token,\r\n            user: {\r\n                id: userExists._id,\r\n                name: `${userExists.firstName} ${userExists.lastName}`,\r\n                email: userExists.email,\r\n            }\r\n        }); \r\n\r\n\r\n\r\n\r\n\r\n\r\n    } catch (error) {\r\n        console.error(\"Login error:\", error);\r\n    return res.status(500).json({\r\n      message: \"Internal server error\",\r\n      success: false\r\n      });\r\n    }\r\n}\r\n\r\n\r\n// LOGOUT CONTROLLER\r\nconst logout = async (req, res) => {\r\n    try {\r\n        res.clearCookie('token');\r\n        res.clearCookie('userInfo');\r\n        res.status(200).json({\r\n            message: \"Logout successful\",\r\n            success: true\r\n        });\r\n    } catch (error) {\r\n        res.status(500).json({\r\n            message: \"Internal server error\",\r\n            success: false,\r\n            error: error.message\r\n        });\r\n    }\r\n};const handleloginForm = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const { email, password } = loginInfo;\r\n    if (!email || !password) {\r\n        return handleError(\"Email and password are required\");\r\n    }\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            \"http://localhost:5000/api/auth/login\", \r\n            loginInfo,\r\n            { withCredentials: true } // Enable cookies\r\n        );\r\n        const result = response.data;\r\n\r\n        if (result.success) {\r\n            handleSuccess(result.message);\r\n            // Cookies are automatically stored by the browser\r\n            setIsAuthenticated(true);\r\n            setTimeout(() => navigate(\"/\"), 1000);\r\n        } else {\r\n            handleError(result.message);\r\n        }\r\n    } catch (error) {\r\n        handleError(error.message);\r\n    }\r\n};\r\n\r\nmodule.exports = {\r\n    signup,\r\n    login,\r\n    logout,\r\n};"
        }
    ]
}