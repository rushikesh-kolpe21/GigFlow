{
    "sourceFile": "backend/Routers/Bid.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 8,
            "patches": [
                {
                    "date": 1768193020118,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768194897286,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,28 @@\n+// routes/bid.js\r\n const express = require(\"express\");\r\n const router = express.Router();\r\n-const Bid = require(\"../Models/Bid\");\r\n+const Bid = require(\"../models/Bid\");\r\n+const auth = require(\"../middleware/auth\");\r\n \r\n-router.post(\"/\", async (req, res) => {\r\n+router.post(\"/\", auth, async (req, res) => {\r\n   const { gigId, message, price } = req.body;\r\n \r\n+  // optional: prevent duplicate bid\r\n+  const alreadyBid = await Bid.findOne({\r\n+    gigId,\r\n+    freelancerId: req.user.id\r\n+  });\r\n+\r\n+  if (alreadyBid) {\r\n+    return res.status(400).json({ message: \"You already applied\" });\r\n+  }\r\n+\r\n   const bid = await Bid.create({\r\n     gigId,\r\n+    freelancerId: req.user.id, // ðŸ‘ˆ from cookie (real user)\r\n     message,\r\n-    price,\r\n-    freelancerId: \"66b2b2b2b2b2b2b2b2b2b2b2\", // ðŸ‘ˆ dummy user\r\n-    status: \"pending\"\r\n+    price\r\n   });\r\n \r\n   res.status(201).json(bid);\r\n });\r\n"
                },
                {
                    "date": 1768194950756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n // routes/bid.js\r\n const express = require(\"express\");\r\n const router = express.Router();\r\n-const Bid = require(\"../models/Bid\");\r\n+const Bid = require(\"../Models/Bid\");\r\n const auth = require(\"../middleware/auth\");\r\n \r\n router.post(\"/\", auth, async (req, res) => {\r\n   const { gigId, message, price } = req.body;\r\n"
                },
                {
                    "date": 1768196136894,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n // routes/bid.js\r\n const express = require(\"express\");\r\n const router = express.Router();\r\n const Bid = require(\"../Models/Bid\");\r\n-const auth = require(\"../middleware/auth\");\r\n+const auth = require(\"../Middlewares/auth\");\r\n \r\n router.post(\"/\", auth, async (req, res) => {\r\n   const { gigId, message, price } = req.body;\r\n \r\n"
                },
                {
                    "date": 1768198387513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,5 +26,13 @@\n \r\n   res.status(201).json(bid);\r\n });\r\n \r\n+// my applications\r\n+router.get(\"/my\", auth, async (req, res) => {\r\n+  const bids = await Bid.find({ freelancerId: req.user.id })\r\n+    .populate(\"gigId\", \"title budget status\"); // gig details\r\n+\r\n+  res.json(bids);\r\n+});\r\n+\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1768198775727,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,5 +34,28 @@\n \r\n   res.json(bids);\r\n });\r\n \r\n+// get bids for a gig (only owner can see)\r\n+router.get(\"/:gigId\", auth, async (req, res) => {\r\n+  const { gigId } = req.params;\r\n+\r\n+  // 1ï¸âƒ£ Gig find karo\r\n+  const gig = await Gig.findById(gigId);\r\n+\r\n+  if (!gig) {\r\n+    return res.status(404).json({ message: \"Gig not found\" });\r\n+  }\r\n+\r\n+  // 2ï¸âƒ£ Owner check (CRUCIAL)\r\n+  if (gig.ownerId.toString() !== req.user.id) {\r\n+    return res.status(403).json({ message: \"Access denied\" });\r\n+  }\r\n+\r\n+  // 3ï¸âƒ£ Is gig ke saare bids lao\r\n+  const bids = await Bid.find({ gigId })\r\n+    .populate(\"freelancerId\", \"name email\");\r\n+\r\n+  res.json(bids);\r\n+});\r\n+\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1768200085726,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,60 +2,72 @@\n const express = require(\"express\");\r\n const router = express.Router();\r\n const Bid = require(\"../Models/Bid\");\r\n const auth = require(\"../Middlewares/auth\");\r\n+const Gig = require(\"../Models/Gig\");\r\n \r\n router.post(\"/\", auth, async (req, res) => {\r\n-  const { gigId, message, price } = req.body;\r\n+  try {\r\n+    const { gigId, message, price } = req.body;\r\n \r\n-  // optional: prevent duplicate bid\r\n-  const alreadyBid = await Bid.findOne({\r\n-    gigId,\r\n-    freelancerId: req.user.id\r\n-  });\r\n+    // optional: prevent duplicate bid\r\n+    const alreadyBid = await Bid.findOne({\r\n+      gigId,\r\n+      freelancerId: req.user.id\r\n+    });\r\n \r\n-  if (alreadyBid) {\r\n-    return res.status(400).json({ message: \"You already applied\" });\r\n-  }\r\n+    if (alreadyBid) {\r\n+      return res.status(400).json({ message: \"You already applied\" });\r\n+    }\r\n \r\n-  const bid = await Bid.create({\r\n-    gigId,\r\n-    freelancerId: req.user.id, // ðŸ‘ˆ from cookie (real user)\r\n-    message,\r\n-    price\r\n-  });\r\n+    const bid = await Bid.create({\r\n+      gigId,\r\n+      freelancerId: req.user.id, // from cookie (real user)\r\n+      message,\r\n+      price\r\n+    });\r\n \r\n-  res.status(201).json(bid);\r\n+    res.status(201).json(bid);\r\n+  } catch (err) {\r\n+    res.status(500).json({ message: err.message || \"Server error\" });\r\n+  }\r\n });\r\n \r\n // my applications\r\n router.get(\"/my\", auth, async (req, res) => {\r\n-  const bids = await Bid.find({ freelancerId: req.user.id })\r\n-    .populate(\"gigId\", \"title budget status\"); // gig details\r\n+  try {\r\n+    const bids = await Bid.find({ freelancerId: req.user.id })\r\n+      .populate(\"gigId\", \"title budget status\"); // gig details\r\n \r\n-  res.json(bids);\r\n+    res.json(bids);\r\n+  } catch (err) {\r\n+    res.status(500).json({ message: err.message || \"Server error\" });\r\n+  }\r\n });\r\n \r\n // get bids for a gig (only owner can see)\r\n-router.get(\"/:gigId\", auth, async (req, res) => {\r\n-  const { gigId } = req.params;\r\n+router.get(\"/gig/:gigId\", auth, async (req, res) => {\r\n+  try {\r\n+    const { gigId } = req.params;\r\n \r\n-  // 1ï¸âƒ£ Gig find karo\r\n-  const gig = await Gig.findById(gigId);\r\n+    // Find gig\r\n+    const gig = await Gig.findById(gigId);\r\n+    if (!gig) {\r\n+      return res.status(404).json({ message: \"Gig not found\" });\r\n+    }\r\n \r\n-  if (!gig) {\r\n-    return res.status(404).json({ message: \"Gig not found\" });\r\n-  }\r\n+    // Owner check\r\n+    if (gig.ownerId.toString() !== req.user.id) {\r\n+      return res.status(403).json({ message: \"Access denied\" });\r\n+    }\r\n \r\n-  // 2ï¸âƒ£ Owner check (CRUCIAL)\r\n-  if (gig.ownerId.toString() !== req.user.id) {\r\n-    return res.status(403).json({ message: \"Access denied\" });\r\n+    // All bids for this gig\r\n+    const bids = await Bid.find({ gigId })\r\n+      .populate(\"freelancerId\", \"firstName lastName email\");\r\n+\r\n+    res.json(bids);\r\n+  } catch (err) {\r\n+    res.status(500).json({ message: err.message || \"Server error\" });\r\n   }\r\n-\r\n-  // 3ï¸âƒ£ Is gig ke saare bids lao\r\n-  const bids = await Bid.find({ gigId })\r\n-    .populate(\"freelancerId\", \"name email\");\r\n-\r\n-  res.json(bids);\r\n });\r\n \r\n module.exports = router;\r\n"
                },
                {
                    "date": 1768230582907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,10 @@\n const Bid = require(\"../Models/Bid\");\r\n const auth = require(\"../Middlewares/auth\");\r\n const Gig = require(\"../Models/Gig\");\r\n \r\n+const mongoose = require(\"mongoose\");\r\n+\r\n router.post(\"/\", auth, async (req, res) => {\r\n   try {\r\n     const { gigId, message, price } = req.body;\r\n \r\n@@ -69,5 +71,67 @@\n     res.status(500).json({ message: err.message || \"Server error\" });\r\n   }\r\n });\r\n \r\n+// hire a freelancer (select a bid)\r\n+\r\n+router.patch(\"/:bidId/hire\", auth, async (req, res) => {\r\n+  const session = await mongoose.startSession();\r\n+  session.startTransaction();\r\n+\r\n+  try {\r\n+    const { bidId } = req.params;\r\n+\r\n+    // 1ï¸âƒ£ Selected bid lao\r\n+    const bid = await Bid.findById(bidId).session(session);\r\n+    if (!bid) {\r\n+      await session.abortTransaction();\r\n+      return res.status(404).json({ message: \"Bid not found\" });\r\n+    }\r\n+\r\n+    // 2ï¸âƒ£ Gig lao\r\n+    const gig = await Gig.findById(bid.gigId).session(session);\r\n+    if (!gig) {\r\n+      await session.abortTransaction();\r\n+      return res.status(404).json({ message: \"Gig not found\" });\r\n+    }\r\n+\r\n+    // 3ï¸âƒ£ Owner check\r\n+    if (gig.ownerId.toString() !== req.user.id) {\r\n+      await session.abortTransaction();\r\n+      return res.status(403).json({ message: \"Not authorized\" });\r\n+    }\r\n+\r\n+    // 4ï¸âƒ£ Gig already assigned?\r\n+    if (gig.status === \"assigned\") {\r\n+      await session.abortTransaction();\r\n+      return res.status(400).json({ message: \"Gig already assigned\" });\r\n+    }\r\n+\r\n+    // 5ï¸âƒ£ Gig status update\r\n+    gig.status = \"assigned\";\r\n+    await gig.save({ session });\r\n+\r\n+    // 6ï¸âƒ£ Selected bid â†’ hired\r\n+    bid.status = \"hired\";\r\n+    await bid.save({ session });\r\n+\r\n+    // 7ï¸âƒ£ Other bids â†’ rejected\r\n+    await Bid.updateMany(\r\n+      { gigId: gig._id, _id: { $ne: bid._id } },\r\n+      { status: \"rejected\" },\r\n+      { session }\r\n+    );\r\n+\r\n+    await session.commitTransaction();\r\n+\r\n+    res.json({ message: \"Freelancer hired successfully\" });\r\n+\r\n+  } catch (error) {\r\n+    await session.abortTransaction();\r\n+    res.status(500).json({ message: \"Hiring failed\" });\r\n+  } finally {\r\n+    session.endSession();\r\n+  }\r\n+});\r\n+\r\n module.exports = router;\r\n"
                },
                {
                    "date": 1768232800036,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,64 +74,52 @@\n \r\n // hire a freelancer (select a bid)\r\n \r\n router.patch(\"/:bidId/hire\", auth, async (req, res) => {\r\n-  const session = await mongoose.startSession();\r\n-  session.startTransaction();\r\n-\r\n   try {\r\n     const { bidId } = req.params;\r\n \r\n     // 1ï¸âƒ£ Selected bid lao\r\n-    const bid = await Bid.findById(bidId).session(session);\r\n+    const bid = await Bid.findById(bidId);\r\n     if (!bid) {\r\n-      await session.abortTransaction();\r\n       return res.status(404).json({ message: \"Bid not found\" });\r\n     }\r\n \r\n     // 2ï¸âƒ£ Gig lao\r\n-    const gig = await Gig.findById(bid.gigId).session(session);\r\n+    const gig = await Gig.findById(bid.gigId);\r\n     if (!gig) {\r\n-      await session.abortTransaction();\r\n       return res.status(404).json({ message: \"Gig not found\" });\r\n     }\r\n \r\n     // 3ï¸âƒ£ Owner check\r\n     if (gig.ownerId.toString() !== req.user.id) {\r\n-      await session.abortTransaction();\r\n       return res.status(403).json({ message: \"Not authorized\" });\r\n     }\r\n \r\n     // 4ï¸âƒ£ Gig already assigned?\r\n     if (gig.status === \"assigned\") {\r\n-      await session.abortTransaction();\r\n       return res.status(400).json({ message: \"Gig already assigned\" });\r\n     }\r\n \r\n     // 5ï¸âƒ£ Gig status update\r\n     gig.status = \"assigned\";\r\n-    await gig.save({ session });\r\n+    await gig.save();\r\n \r\n     // 6ï¸âƒ£ Selected bid â†’ hired\r\n     bid.status = \"hired\";\r\n-    await bid.save({ session });\r\n+    await bid.save();\r\n \r\n     // 7ï¸âƒ£ Other bids â†’ rejected\r\n     await Bid.updateMany(\r\n       { gigId: gig._id, _id: { $ne: bid._id } },\r\n-      { status: \"rejected\" },\r\n-      { session }\r\n+      { status: \"rejected\" }\r\n     );\r\n \r\n-    await session.commitTransaction();\r\n-\r\n     res.json({ message: \"Freelancer hired successfully\" });\r\n \r\n   } catch (error) {\r\n-    await session.abortTransaction();\r\n-    res.status(500).json({ message: \"Hiring failed\" });\r\n-  } finally {\r\n-    session.endSession();\r\n+    console.error(\"Hire error:\", error);\r\n+    res.status(500).json({ message: error.message || \"Hiring failed\" });\r\n   }\r\n });\r\n \r\n module.exports = router;\r\n"
                }
            ],
            "date": 1768193020118,
            "name": "Commit-0",
            "content": "const express = require(\"express\");\r\nconst router = express.Router();\r\nconst Bid = require(\"../Models/Bid\");\r\n\r\nrouter.post(\"/\", async (req, res) => {\r\n  const { gigId, message, price } = req.body;\r\n\r\n  const bid = await Bid.create({\r\n    gigId,\r\n    message,\r\n    price,\r\n    freelancerId: \"66b2b2b2b2b2b2b2b2b2b2b2\", // ðŸ‘ˆ dummy user\r\n    status: \"pending\"\r\n  });\r\n\r\n  res.status(201).json(bid);\r\n});\r\n\r\nmodule.exports = router;\r\n"
        }
    ]
}