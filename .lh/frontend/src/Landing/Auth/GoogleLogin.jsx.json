{
    "sourceFile": "frontend/src/Landing/Auth/GoogleLogin.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1768361668823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1768361668823,
            "name": "Commit-0",
            "content": "import React from 'react'\r\nimport { useGoogleLogin } from '@react-oauth/google';\r\nimport { handleSuccess, handleError } from '../../../utils';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport const GoogleLogin = ({ setIsAuthenticated }) => {\r\n  const navigate = useNavigate();\r\n\r\n  const responseGoogle = async (authResult) => {\r\n    try {\r\n      console.log('Google Auth Result:', authResult);\r\n\r\n      if (authResult.error) {\r\n        handleError(\"Google login cancelled or failed\");\r\n        return;\r\n      }\r\n\r\n      const idToken = authResult.credential;\r\n      const accessToken = authResult.access_token;\r\n\r\n      if (!idToken && !accessToken) {\r\n        handleError(\"No credential received from Google\");\r\n        return;\r\n      }\r\n\r\n      console.log(\"Sending token to backend...\");\r\n      \r\n      //  Send token to backend (prefer idToken, fallback to accessToken)\r\n      const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/auth/google`, {\r\n        idToken,\r\n        accessToken,\r\n      }, { withCredentials: true });  //  CRITICAL: Allow cookies to be set!\r\n\r\n      console.log('Backend Response:', response.data);\r\n\r\n      const { success, token, user, message } = response.data;\r\n\r\n      if (success && token) {\r\n        // ðŸ”¹ Store user data in localStorage (token is in HTTP-Only cookie)\r\n        localStorage.setItem(\"token\", token);\r\n        localStorage.setItem(\"user\", JSON.stringify(user));\r\n\r\n        handleSuccess(message || \"Google login successful!\");\r\n        setIsAuthenticated(true);\r\n\r\n        // ðŸ”¹ Redirect to gigs after brief delay\r\n        setTimeout(() => {\r\n          navigate(\"/gigs\");\r\n        }, 600);\r\n      } else {\r\n        handleError(message || \"Google login failed\");\r\n      }\r\n\r\n    } catch (error) {\r\n      const errorMsg = error?.response?.data?.message || error.message || \"Google login failed\";\r\n      const errorDetails = error?.response?.data?.error;\r\n      console.error(\" Google login error:\", error.message);\r\n      console.error(\"Backend error details:\", errorDetails);\r\n      handleError(errorMsg);\r\n    }\r\n  };\r\n\r\n  // Initialize Google Login hook\r\n  const handleGoogleLogin = useGoogleLogin({\r\n    onSuccess: responseGoogle,\r\n    onError: responseGoogle,\r\n    flow: 'implicit'\r\n  });\r\n\r\n return (\r\n  <button\r\n    onClick={handleGoogleLogin}\r\n    type=\"button\"\r\n    className=\"\r\n      w-full\r\n      py-2.5\r\n      mb-4\r\n      bg-white\r\n      border border-gray-300\r\n      rounded-xl\r\n      hover:bg-gray-50\r\n      transition\r\n      flex\r\n      items-center\r\n      justify-center\r\n      gap-3\r\n      text-gray-700\r\n      font-medium\r\n    \"\r\n  >\r\n    {/* Google Logo */}\r\n    <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n      <path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\r\n      <path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\r\n      <path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\r\n      <path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\r\n    </svg>\r\n\r\n    <span>Continue with Google</span>\r\n  </button>\r\n);\r\n\r\n};\r\n"
        }
    ]
}