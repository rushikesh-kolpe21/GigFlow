{
    "sourceFile": "frontend/src/Landing/Auth/Login.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1768152308481,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768154029583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,10 +18,10 @@\n   const navigate = useNavigate();\r\n \r\n   // If already logged in, redirect away from login\r\n   useEffect(() => {\r\n-    const token = localStorage.getItem(\"token\");\r\n-    if (token) {\r\n+    const userInfo = document.cookie.includes('userInfo');\r\n+    if (userInfo) {\r\n       navigate(\"/\", { replace: true });\r\n     }\r\n   }, [navigate]);\r\n \r\n@@ -40,21 +40,20 @@\n       return handleError(\"Email and password are required\");\r\n     }\r\n \r\n     try {\r\n-      const response = await axios.post(\"http://localhost:5000/api/auth/login\", loginInfo);\r\n+      const response = await axios.post(\"http://localhost:5000/api/auth/login\", loginInfo, {\r\n+        withCredentials: true // Enable cookies\r\n+      });\r\n       const result = response.data;\r\n       console.log(\"Login API Response:\", result);\r\n \r\n       const { user, message, token, success } = result;\r\n \r\n       if (success) {\r\n         handleSuccess(message);\r\n-\r\n-        localStorage.setItem(\"token\", token);\r\n-        localStorage.setItem(\"loggedInUser\", user.name);\r\n-        localStorage.setItem(\"userEmail\", user.email);\r\n-        localStorage.setItem(\"userId\", user.id);\r\n+        // Cookies are automatically stored by the browser via Set-Cookie header\r\n+        // No need to manually store in localStorage\r\n         setIsAuthenticated(true);\r\n         setTimeout(() => {\r\n           navigate(\"/\");\r\n         }, 600);\r\n"
                },
                {
                    "date": 1768189305492,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,11 +18,11 @@\n   const navigate = useNavigate();\r\n \r\n   // If already logged in, redirect away from login\r\n   useEffect(() => {\r\n-    const userInfo = document.cookie.includes('userInfo');\r\n-    if (userInfo) {\r\n-      navigate(\"/\", { replace: true });\r\n+    const hasToken = Boolean(localStorage.getItem(\"token\")) || document.cookie.includes(\"token\");\r\n+    if (hasToken) {\r\n+      navigate(\"/gigs\", { replace: true });\r\n     }\r\n   }, [navigate]);\r\n \r\n   const handleChange = (event) => {\r\n@@ -50,13 +50,18 @@\n       const { user, message, token, success } = result;\r\n \r\n       if (success) {\r\n         handleSuccess(message);\r\n+        // Persist the token so PrivateRoute sees it and avoids redirect loops\r\n+        localStorage.setItem(\"token\", token);\r\n+        if (user) {\r\n+          localStorage.setItem(\"user\", JSON.stringify(user));\r\n+        }\r\n         // Cookies are automatically stored by the browser via Set-Cookie header\r\n         // No need to manually store in localStorage\r\n         setIsAuthenticated(true);\r\n         setTimeout(() => {\r\n-          navigate(\"/\");\r\n+          navigate(\"/gigs\");\r\n         }, 600);\r\n       } else {\r\n         handleError(message || \"Login failed\");\r\n       }\r\n"
                }
            ],
            "date": 1768152308481,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { ToastContainer } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\nimport { handleError, handleSuccess } from \"../../../utils\";\r\nimport axios from \"axios\";\r\n// import { GoogleLogin } from \"./GoogleLogin\";\r\n\r\n\r\nexport const Login = ({ setIsAuthenticated = () => {} }) => {\r\n\r\n\r\n\r\n  const [loginInfo, setloginInfo] = useState({\r\n    email: \"\",\r\n    password: \"\",\r\n  });\r\n  const navigate = useNavigate();\r\n\r\n  // If already logged in, redirect away from login\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      navigate(\"/\", { replace: true });\r\n    }\r\n  }, [navigate]);\r\n\r\n  const handleChange = (event) => {\r\n    const { name, value } = event.target;\r\n    const copyloginInfo = { ...loginInfo };\r\n    copyloginInfo[name] = value;\r\n    setloginInfo(copyloginInfo);\r\n  };\r\n  // after submit\r\n  const handleloginForm = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const { email, password } = loginInfo;\r\n    if (!email || !password) {\r\n      return handleError(\"Email and password are required\");\r\n    }\r\n\r\n    try {\r\n      const response = await axios.post(\"http://localhost:5000/api/auth/login\", loginInfo);\r\n      const result = response.data;\r\n      console.log(\"Login API Response:\", result);\r\n\r\n      const { user, message, token, success } = result;\r\n\r\n      if (success) {\r\n        handleSuccess(message);\r\n\r\n        localStorage.setItem(\"token\", token);\r\n        localStorage.setItem(\"loggedInUser\", user.name);\r\n        localStorage.setItem(\"userEmail\", user.email);\r\n        localStorage.setItem(\"userId\", user.id);\r\n        setIsAuthenticated(true);\r\n        setTimeout(() => {\r\n          navigate(\"/\");\r\n        }, 600);\r\n      } else {\r\n        handleError(message || \"Login failed\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Login error:\", error);\r\n      const serverMsg = error?.response?.data?.message;\r\n      handleError(serverMsg || error.message || \"Login failed\");\r\n    }\r\n  };\r\n\r\n  \r\n  return (\r\n    <div className=\"flex items-center justify-center min-h-screen bg-gray-100\">\r\n      <div className=\"w-full max-w-md bg-white p-8 rounded-2xl shadow-lg\">\r\n        <h1 className=\"text-3xl font-bold text-center text-blue-600 mb-6\">\r\n          Login to Your Account\r\n        </h1>\r\n\r\n        {/* <GoogleLogin setIsAuthenticated={setIsAuthenticated}\r\n         onSuccess={(res) => {\r\n    console.log(res.credential); // âœ… ID TOKEN */}\r\n  {/* }} /> */}\r\n\r\n        <form onSubmit={handleloginForm} className=\"space-y-5 text-left\">\r\n          <div className=\"flex flex-col items-start\">\r\n            <label\r\n              htmlFor=\"email\"\r\n              className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n            >\r\n              Email Address\r\n            </label>\r\n            <input\r\n              onChange={handleChange}\r\n              name=\"email\"\r\n              value={loginInfo.email}\r\n              id=\"email\"\r\n              type=\"email\"\r\n              placeholder=\"Enter your email\"\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex flex-col items-start\">\r\n            <label\r\n              htmlFor=\"password\"\r\n              className=\"block text-sm font-medium text-gray-700 mb-1\"\r\n            >\r\n              Password\r\n            </label>\r\n            <input\r\n              onChange={handleChange}\r\n              name=\"password\"\r\n              value={loginInfo.password}\r\n              id=\"password\"\r\n              type=\"password\"\r\n              placeholder=\"Enter your password\"\r\n              className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n            />\r\n          </div>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"w-full py-2 mt-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition duration-200\"\r\n          >\r\n            Login\r\n          </button>\r\n\r\n          <p className=\"text-center text-sm text-gray-600 mt-3\">\r\n            Does't have an account?{\" \"}\r\n            <Link\r\n              to=\"/register\"\r\n              className=\"text-blue-600 font-medium hover:underline\"\r\n            >\r\n              Signup\r\n            </Link>\r\n          </p>\r\n        </form>\r\n\r\n        <ToastContainer position=\"top-center\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}